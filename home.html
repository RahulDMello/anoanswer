<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>anoanswer</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <script src = "node_modules\socket.io\node_modules\socket.io-client\dist\socket.io.js"></script>  <!-- for localhost -->
        <!-- <script src ="/socket.io/socket.io.js"></script> for server deploy -->
        <script>

            var socket = io('http://localhost:8080');  // for localhost
            // var socket = io('https://calm-crag-26465.herokuapp.com/');  for server deploy

            console.log(socket);

            function isEnterKey(event) {
                if (event.keyCode === 13) {
                    updateQuestion();
                }
            }

            function updateQuestion() {
                socket.emit('RecieveNewQuestion', document.getElementById('txtInput').value);
                document.getElementById('txtInput').value = "";
            }

            socket.on('AttachNewQuestion', function (msg) {
                document.getElementById('messages').innerHTML = msg;
            });

            socket.on('AddNewQuestionToList', function (msg) {
                document.getElementById('questions').innerHTML = '';
                Object.keys(msg).forEach(function(key){
                    document.getElementById('questions').innerHTML += '<br/>' + msg[key];
                });
            });

            function updatePosition() {
                updatePositionHelper(positionUpdateSuccessCallback, function () {
                    console.log('Cannot get location');
                });
                setInterval(updatePositionHelper(positionUpdateSuccessCallback, function () {
                    console.log('Cannot get location');
                }), 5000);
            }

            function positionUpdateSuccessCallback(coords) {
                socket.emit('UpdatePosition', {coords: {'latitude': coords.latitude, 'longitude': coords.longitude}});
                console.log(coords);
            }

            function updatePositionHelper(successCallback, errorCallback) {
                successCallback = successCallback || function () {
                };
                errorCallback = errorCallback || function () {
                };

                // Try HTML5-spec geolocation.
                var geolocation = navigator.geolocation;

                if (geolocation) {
                    // We have a real geolocation service.
                    try {
                        function handleSuccess(position) {
                            successCallback(position.coords);
                        }

                        geolocation.watchPosition(handleSuccess, errorCallback, {
                            enableHighAccuracy: true,
                            maximumAge: 5000 // 5 sec.
                        });
                    } catch (err) {
                        errorCallback();
                    }
                } else {
                    errorCallback();
                }
            }

        </script>
    </head>
    <body onload="updatePosition()">
        <h1 id="messages"> ASK A QUESTION : </h1>
        <input type='text' id='txtInput' onkeypress=isEnterKey(event) />
        <input type='button' onclick=updateQuestion() class="btn btn-default btn-lg" value="submit" />
        <h2> ANSWER ANY OF THE FOLLOWING QUESTIONS </h2>
        <div id = "questions"></div>
    </body>
</html>
